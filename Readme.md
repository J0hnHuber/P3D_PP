# ğŸ“„ P3D Postprozessor System â€“ Erweiterte Dokumentation

## ğŸ“š Inhalt

- [Einleitung](#einleitung)
- [IP3DPostProcessor Funktionen erklÃ¤rt](#ip3dpostprocessor-funktionen-erklÃ¤rt)
  - [Initialize](#initialize)
  - [Fedrat](#fedrat)
  - [Goto](#goto)
  - [Rapid](#rapid)
  - [PPrint](#pprint)
  - [MultAx](#multax)
  - [Done](#done)
- [Dynamische Formulare mit FormInput](#dynamische-formulare-mit-forminput)
- [Beispielhafte Nutzung](#beispielhafte-nutzung)
- [Erweiterungsideen](#erweiterungsideen)

---

## Einleitung

Dieses Postprozessor-System basiert auf dem `IP3DPostProcessor` Interface und wird von P3D automatisch aufgerufen, wenn eine APT-Datei verarbeitet wird. Jede APT-Anweisung (`FEDRAT`, `GOTO`, `PPRINT`, usw.) lÃ¶st einen Methodenaufruf aus. Innerhalb dieser Methoden erzeugt der Entwickler gezielt G-Code-Zeilen mit Hilfe des Register-Systems.

---

## IP3DPostProcessor Funktionen erklÃ¤rt

### ğŸŸ© `Initialize(CLData data)`

**Wann:**  
Wird **einmalig am Anfang** der Verarbeitung aufgerufen.

**Was sie macht:**  
- Zeigt ein Eingabedialog mit Feldern wie Text, Checkbox, Integer, Float, ComboBox.
- Initialisiert Register mit z.B. `X`, `Y`, `Z`, `F`, `G`.
- Setzt die automatische Nummerierung fÃ¼r G-Code-Zeilen.
- Gibt Header-Kommentare im G-Code aus (Datum, Copyright).

**Wichtig:**  
Register mÃ¼ssen hier mindestens einmal registriert werden, damit sie spÃ¤ter verwendet werden kÃ¶nnen.

**Beispiel:**
```csharp
RegisterAdd("X", "X", decimalPlaces: 4, trailingZeros: 5);
RegisterAdd("F", "F");
```

**Headerausgabe:**
```text
; Code generated by P3D ...
```

---

### ğŸŸ© `Fedrat(CLData data)`

**Wann:**  
Immer, wenn der Befehl `FEDRAT / <WERT>` im APT erscheint.

**Was sie macht:**  
- Setzt den Registerwert fÃ¼r Vorschub `F` (Feedrate).
- Merkt sich, dass die Bewegung **nicht** mehr "rapid" ist (`_isRapid = false`).

**Achtung:**  
Die Feedrate wird nicht direkt ausgegeben â€“ sie wird beim nÃ¤chsten `GOTO` mit ausgegeben.

**Beispiel APT:**
```text
FEDRAT / 500
```

**Intern:**
```csharp
RegisterSetValue("F", data["F"]);
```

---

### ğŸŸ© `Goto(CLData data)`

**Wann:**  
Bei jeder `GOTO / X,Y,Z` Anweisung in der APT-Datei.

**Was sie macht:**  
- Setzt Positionsdaten in den Registern `X`, `Y`, `Z`.
- PrÃ¼ft mit `ShouldOutblock()`, ob sich etwas geÃ¤ndert hat.
- Gibt einen G-Code Outblock aus.
- FÃ¼gt G0 (schnell) oder G1 (normal) in Register `G` je nach `_isRapid`.

**APT Beispiel:**
```text
GOTO / 12.5, 25.7, -1.0
```

**Erzeugter G-Code:**
```text
N10 G1 X12.5000 Y25.7000 Z-1.0000 F500
```

---

### ğŸŸ© `Rapid(CLData data)`

**Wann:**  
Bei Auftreten von `RAPID` im APT-Code.

**Was sie macht:**  
- Setzt den Flag `_isRapid = true`.
- Damit werden folgende Bewegungen als `G0` statt `G1` interpretiert.

**APT Beispiel:**
```text
RAPID
```

**Folgende GOTO wird dann:**
```text
N20 G0 X30.0000 Y50.0000 Z10.0000
```

---

### ğŸŸ© `PPrint(CLData data)`

**Wann:**  
Immer wenn `PPRINT / 'text'` in der APT steht.

**Was sie macht:**  
- Gibt den Ã¼bergebenen Kommentar in den G-Code als `; Kommentar` aus.

**APT Beispiel:**
```text
PPRINT / 'Start position'
```

**G-Code:**
```text
; Start position
```

---

### ğŸŸ© `MultAx(CLData data)`

**Wann:**  
Bei `MULTAX / ON` oder `MULTAX / OFF`.

**Was sie macht:**  
- Setzt den Flag `_multAx` auf `true` oder `false`.

**Hinweis:**  
Dieser Wert kann spÃ¤ter genutzt werden, um mehrachsige Maschinen speziell zu behandeln.

---

### ğŸŸ© `Done()`

**Wann:**  
Ganz am Ende der APT-Verarbeitung.

**Was sie macht:**  
- Holt den gesamten G-Code mit `RegisterGetCode()`.
- Gibt dir die MÃ¶glichkeit, den G-Code nachtrÃ¤glich zu modifizieren.
- Du kannst z.â€¯B. letzte Kommentare hinzufÃ¼gen oder leere Zeilen entfernen.

**Tipp:**  
Bearbeite `gcodeLines[]` hier mit Schleifen, Regex etc.

---

## Dynamische Formulare mit `FormInput`

### Verwendung in `Initialize()`

```csharp
var parameters = new List<InputFormParameter>
{
    new InputFormParameter { Name = "Speed", Type = InputType.Float, Value = 100.0f },
    new InputFormParameter { Name = "Enable Coolant", Type = InputType.Checkbox, Value = true },
    new InputFormParameter { Name = "Mode", Type = InputType.ComboBox, Value = "Normal", DataSource = new[] { "Fast", "Normal", "Slow" } }
};

if (FormInput.TryGetValues("Machine Setup", parameters, out var result))
{
    var speed = (float)result["Speed"];
    var coolant = (bool)result["Enable Coolant"];
}
```

**MÃ¶gliche Typen:**
- `InputType.Text`
- `InputType.Checkbox`
- `InputType.Integer`
- `InputType.Float`
- `InputType.ComboBox`

---

## Beispielhafte Nutzung

### Beispiel APT-Datei
```text
PPRINT / 'Begin program'
FEDRAT / 600
GOTO / 0,0,0
RAPID
GOTO / 100,50,0
```

### MÃ¶glicher G-Code Output
```text
; Begin program
N10 G1 X0.0000 Y0.0000 Z0.0000 F600
N20 G0 X100.0000 Y50.0000 Z0.0000
```

---

## Erweiterungsideen

- ğŸ”§ Support fÃ¼r weitere APT-Kommandos wie `CIRCLE`, `SPINDL`, `TOOLNO`.
- ğŸ› ï¸ Validierungslogik fÃ¼r Pflichtfelder im UI-Dialog.
- ğŸ’¾ Preset-System fÃ¼r gespeicherte Benutzerparameter.
- ğŸ§ª Automatische Tests fÃ¼r die generierte G-Code-Ausgabe.
- ğŸ–¥ï¸ Erweiterte G-Code Templates mit Vorlagen pro Maschine.

---

## Lizenz

Â© Datentechnik Reitz GmbH & Co. KG  
Nur zur internen Verwendung in Verbindung mit P3D.

